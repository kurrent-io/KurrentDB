@using KurrentDB.UI.Services
@inject Preferences Preferences

<MudDialog Style="height: 70%;">
	<DialogContent>
		<MudMarkdown Styling="@_styling" Value="@HelpText"/>
	</DialogContent>
	<DialogActions>
		<MudButton Color="Color.Primary" OnClick="Ok">Close</MudButton>
	</DialogActions>
</MudDialog>

@code {
	readonly MudMarkdownStyling _styling = new();

	protected override void OnInitialized() {
		base.OnInitialized();
		var theme = Preferences.DarkMode ? CodeBlockTheme.GithubDark : CodeBlockTheme.StackoverflowLight;
		_styling.CodeBlock.Theme = theme;
	}

	[CascadingParameter] private IMudDialogInstance MudDialog { get; set; }

	private void Ok() => MudDialog.Close(DialogResult.Ok(true));

	const string HelpText = @"
##### Available functions

| Function | Parameters | Description |
|----------|------------|-------------|
| `read_all` | None | Read all events |
| `read_all` | `start` | Reads all events for which the log position is greater or equal `start` |
| `read_category` | `category` | Read all events within a given category |
| `read_category` | `category`, `start` | Reads all events within a given category where the log position is greater or equal `start` |
| `read_stream` | `stream` | Reads all events from a specific stream |

##### Example query

The query will find all events with `Version` property set, and then count the number of
streams per found version value.
```
select version, count(*) as count from (
  select distinct version, stream from (
    select k.data->>'$.Version' as version, k.stream_id as stream
    from read_all() k
    where version is not null
  )
) group by version
```
";

}
